# Cosmos 기술 분석

목차
1. 검증인(Validator)
2. 텐더민트(Tendermint) 합의 알고리즘
   1. PBFT 알고리즘
   2. 텐더민트(Tendermint) 알고리즘
3. 텐더민트 라이트 클라이언트
4. Cosmos의 구성
   1. 존(Zone)
   2. 허브(HUB)
5. Cosmos의 장점
   1. Cosmos DEX(Distributed Exchange)
   2. 다른 암호화폐의 고정(Pegging to Other Cryptocurrencies)
   3. Private 네트워크로 활용
   4. 이더리움 확장성


## 1. 검증인
Cosmos는 DPoS 알고리즘처럼 제한된 수의 검증인을 설정하여 마이닝을 수행한다. 제네시스 시 최대 검증인 수는 100명이고, 10년동안 13% 비율로 증가해 최종적으로 300명의 검증인을 가진다.

제네시스 이후에는  아톰 보유자들이 Bonc TX 이체를 서명하여 검증인이 될 수 있다. 허용된 인원 이내에서는 누구라도(잔고가 0보다 클 때) 가능하며 허용된 인원을 초과하는 경우에는 아톰 지분율이 높은 쪽이 검증인이 된다.

검증인에 대한 처벌은 상황에 따라 다르게 이루어진다.
1. 동일한 높이 및 라운드에서 이중서명, 텐더민트 합의 알고리즘의 규칙을 위반하는 행위는 증거를 통해 즉시 인정된다. 이 경우 검증인의 지위를 상실하게 되고, 본딩된 아톰과 '지급 준비금 풀(reverse pool)'내의 토큰의 비례분, 즉 지분(stake)을 상당수 잃는다.
2. 지역 네트워크 단절, 전원 장애 등의 이유로 검증인이 단절된다면, 과거의 어느 시점의 블록에서 검증인의 Commit 투표가 이루어지지 않은 횟수를 카운트하여 일정 횟수가 넘으면 해당 검증인을 비활성화 시키고 지분의 1%를 상실한다.
3.  증거가 불분명한 악의적 행위를 할 경우, 압도적 다수의 합의가 존재한다면 검증인들이 외부에서 합의한 뒤 악의적인 검증인을 강제로 타임아웃 시킬 수 있다. 투표권 1/3 이상이 악의적으로 연합하여 Cosmos를 중단하거나 이들이 악의적 행동의 증거가 블록체인으로 들어오지 않게 검열하여 삭제하는 경우, 허브는 하드포크를 통한 블록 재조정 proposal로 복구된다.


## 2. 텐더민트(Tendermint) 합의 알고리즘
텐더민트 합의 알고리즘은 PBFT(Partical Byzantine Fault Tolorance)와 DPoS 합의 알고리즘을 응용한 방식으로 부분적인 동기를 이용한다. PFBT에 대해 간단하게 짚고 넘어가겠다.

### 1.PFBT 알고리즘

![PBFT](https://www.usenix.org/legacy/event/nsdi09/tech/full_papers/wester/wester_html/img/bftclean.png)

PFBT 알고리즘은 Primary 또는 Leader 라고 불리는 노드가 존재한다. 이 노드는 클라이언트의 요청 순서를 정렬하고, 요청에 대한 결과를 기입하여, 다른 노드에게 전파하는 역할을 한다. 순서는 아래와 같다.

1. Request : 최초 클라이언트에서 트랜잭션이 발생하여  합의를 요청
2. Pre-Prepare : Primary 노드가 요청에 시퀀스 번호를 부여하고 다른 노드에게 합의를 요구하기 위해 전파
3. Prepare : Primary 노드에게 받은 메시지를 다시 한 번 나머지 노드에게 전파
4. Commit : 각 노드에서 자신이 가장 많이 받은 같은 메시지를 확인하여 다른 노드에게 전파

### 2. 텐더민트(Tendermint) 알고리즘
Tender
![Tendermint](https://loopchain.files.wordpress.com/2017/06/tendermint.png?w=840)

위 과정에서 Propose을  Pre-Prepare로, Prevote을 Prepare로, PreCommit을 Commit으로  PFBT 방식과 매칭시키면 이해하기 간단하며, PBFT의 경우 각각의 노드가 하나의 투표를 하는 방식으로 진행되었지만 텐더민트 방식에서는 지분을 기반으로 투표를 진행한다. 즉 노드의 숫자보다 지분 보유량이 더 중요하다.

또한 투표를 진행할 때 자신의 지분을 동결시키는 Locking 메커니즘으로 이중 지불 문제를 해결한다. 그리고 안정성을 저해하는데 시도만 하더라도, 이를 식별할 수 있고 이런 행위를 지분을 뺏는 처벌로 'Nothing at Stake' 문제를 해결한다. 이 합의는 1~2초의 Commit 지연 속도와 함께 초당 수천개의 트랜잭션을 처리한다.


## 3. 텐더민트 라이트 클라이언트
비트코인 라이트 클라이언트는 블록헤더 체인들을 동기화하여 가장 많은 작업 증명을 가진 체인을 찾아야 하지만, 텐더민트 라이트 클라이언트는 '검증인 세트'의 변경을 추적해서 최신 블록에서 2/3 초과의 PreCommit을 검증하기만 하면 최신 상태를 결정할 수 있다. 텐더민트 합의 알고리즘의 특징은 단순화된 라이트 클라이언트 보안인데, 모바일 및 IOT에 사용되기에도 적합하다.


## 4. Cosmos의 구성
Cosmos는 존(Zone)과 허브( HUB)로 구성되고 이 세트가 여러 개 있으며, 어느 존이든 스스로 허브가 되어 비순환 그래프를 형성할 수 있다.

![허브&존 구조](https://cdn-images-1.medium.com/max/1600/1*dwh3Vk1QjnS1BnqJwOYBuQ.png)

1. 존(Zone)
  - 많은 독립된 블록체인의 네트워크이며, 허브와 메시지를 교환하는 독립 블록체인이다. 암호화폐 계정과 마찬가지로 존은 보유 중인 토큰보다 더 많은 토큰을 전송할 수 없지만, 토큰을 보유한 다른 존으로부터 토큰을 수신할 수는 있다.

2. 허브(HUB)
  - 다중 자산 분산 원장(multi-asset distributed ledger)을 관리하는 블록체인으로, 전체 시스템을 위한 토큰의 '중앙 원장' 역할을 한다. 여기서 토큰은 개인이나 존 자체가 보유할 수 있다. 이 토큰들은 코인 패킷(Coin Packet)이라 부르는 특수 IBC(Inter Blockchain Communication) 패킷을 통해 하나의 존에서 다른 존으로 이동할 수 있다. IBC 코인 패킷 이체는 반드시 송신자, 허브 및 수신자 블록체인에 의해 커밋되어야 한다.

허브의 아톰들은  ‘허브에 연결된 존의 검증인’들에 의해 스테이킹될 수도 있다.  투표권의 2/3를 초과하는 존이라면 무효한 상태를 커밋할 수 있다는 것이다. Cosmos 허브는 다른 존들에 커밋 된 이체들은 검증하거나 실행하지 않기 때문에, 자신이 신뢰하는 존으로 토큰을 전송하는 것은 사용자의 책임이다.


## 5. Cosmos의 장점
### 1.Cosmos DEX(Distributed Exchange)
기존의 중앙화된 거래소의 문제를 해소하기 위해 탈중앙화 거래소가 등장하기 시작했다. 이런 탈중앙화 거래소에서는 아토믹 크로스 체인(Atomic Cross Chain, AXC)이라는 기술을 사용했었는데, 이것에는 문제가 있다. 서로가 온라인 상태가 아니라면 거래를 수행할 수 없다는 점이다. 이 문제는 거래소의 거래량 감소로 이어지게 되고, 그렇게 된다면 기존의 중앙화 거래소를 이길 방법은 없어진다.

이 문제의 대안으로 자체적인 분산원장에서 작동하는 '대규모 복제 분산 거래소'가 만들어진다. 이 경우 지정가 주문을 걸고 오프라인 상태가 되더라도, 블록체인이 해당 거래를 매칭시키고 완료시킨다.

이런 블록체인을 활용한 분산 거래소 시스템에서 필요한 것은 트랜잭션의 처리 속도이다. Cosmos DEX(Distributed Exchange)의 이체 처리량과 커밋 속도는 중앙화 거래소에 필적하므로, 탈중앙화된 거래소에서도 빠르게, 그리고 기존의 중앙화 거래소보다 안전하게 거래를 진행할 수 있다.

### 2. 다른 암호화폐의 고정(Pegging to Other Cryptocurrencies)
Cosmos는 페그 존(Peg zone) 개념을 활용해 A라는 페그 존을 이용해 어떤 암호화폐의 거래를 진행을 하려면 해당 암호화폐와 페그 컨트랙트를 A라는 페그 존에 고정시키고, 상대가 반응이 담긴 IBC 패킷이 다시 A 페그 존에 들어올 때까지 해당 암호화폐는 출금할 수 없게 고정된다.

마찬가지로 페그 존에 대해 2/3를 초과하는 악의적인 투표가 행사될 경우 중간에 출금이 가능하게 만들 수 있지만, Cosmos 거버넌스 시스템에 따라 보완은 할 수 있다고 한다. (하지만 이 거버넌스 시스템은 미확정 상태이기 때문에 처리에 대해 또 다른 문제가 발생할 가능성이가 있다.)

### 3. Private 네트워크로 활용
Cosmos의 존들은 존의 생성 초기에 정의된 로직에 따라 작동하며, 거버넌스를 통해 지속적으로 업데이트 될 수 있는 유연함을 갖추고 있다. 이 장점은 1번의 Cosmos Dex로의 활용으로 연결될 수 있고, 기업 및 정부 시스템에서 일부는 통제권을 유지하고 필요 부분에만 존 위의 TMSP(Tendermint Socket Protocol)를 운용하여 Cosmos 네트워크를 Private 하게 사용할 수도 있다.

### 4. 이더리움 확장성
Cosmos의 빠른 처리속도와 페그 존을 이용해 페깅된 이더를 운용하는 EVM 존들은 기존의 이더리움 블록체인보다 빠른 속도로 블록들을 커밋할 수 있다. 또한 이더리움 스케일링 문제에 대한 해결책으로 샤딩보다는  Dapp의 체인을 분리시켜 Cosmos 독립적인 존 올리는 식으로 활용할 수 있다.
